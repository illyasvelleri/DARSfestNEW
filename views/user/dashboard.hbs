<link rel='stylesheet' href='/stylesheets/userStyle.css' />

<body>
    <div class="sign-out-card">
        <div class="card py-3 shadow-sm">
            <p>alathurpadiDars@gmail.com</p>
            <img src="https://wallpapercave.com/wp/wp2525416.jpg" alt="">
            <h2 class="my-2">Hai, ADSA!</h2>
            <button class="manage-btn mb-2">Manage Your Leaders</button>
            <span class="mt-3">
                <button class="view-btn">
                    <h5 class="m-auto"><i class="fa-regular fa-eye me-2"></i>View</h5>
                </button>
                <button class="sign-out-btn">
                    <h5 class="m-auto"><i class="fa-solid fa-right-from-bracket me-2"></i>Sign out</h5>
                </button>
            </span>
        </div>
    </div>
    <div>
        <span class="user-drop-down"><i class="fa-solid fa-arrow-right-from-bracket"></i>
            <p>Log Out</p>
        </span>
    </div>
    <div class="container dashboard">
        <div class="row pt-5">
            <div class="col-md-4">
                <div class="view-user">
                    <h4 class="mb-3">View Users</h4>
                    <div class="card" onclick="location.href='#view-users'">
                        <h2>Hai, Group Leader<span class="tooltip mb-2">Click to view more details</span></h2>
                        <div class="balance">
                            <h3>$9,000</h3>
                            <p>Remaining Balance</p>
                        </div>
                    </div>
                </div>

                <!---upcoming....bids-->
                <div class="row upcoming-Bid-container">
                    <h4 class="mb-3 view-user">Upcoming Bids</h4>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="upcoming-Bids">
                                <p class="text-center px-2">Sub Junior</p>
                                <ul class="bidd-list ps-3">
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="upcoming-Bids">
                                <p class="text-center px-2">Junior</p>
                                <ul class="bidd-list ps-3">
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="upcoming-Bids">
                                <p class="text-center px-2">Senior</p>
                                <ul class="bidd-list ps-3">
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="upcoming-Bids">
                                <p class="text-center px-2">Super Senior</p>
                                <ul class="bidd-list ps-3">
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                    <li class="bidd-item">
                                        <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg"
                                            alt="" height="40">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- user/dashboard.hbs -->
            <div class="col-md-8">
                <h4 class="mb-3">Current Bid</h4>
                <div class="current-bid">
                    <div class="card bg-dark">
                        <div class="container">
                            {{#if currentBidMember}}
                            <div class="row py-4">
                                <div class="col-md-6">
                                    <div class="img-container">
                                        <img src="/images/{{currentBidMember.member.img}}" class=""
                                            alt="{{currentBidMember.name}}" width="400">
                                        <h2>{{currentBidMember.member.name}}</h2>
                                    </div>
                                    <div class="btns mt-3">
                                        <button class="btn btn-info bid-btn" data-bid="50">Bid ₹50</button>
                                        <button class="btn btn-info bid-btn" data-bid="100">Bid ₹100</button>
                                        <button class="btn btn-info bid-btn" data-bid="200">Bid ₹200</button>
                                        <button class="btn btn-info bid-btn" data-bid="500">Bid ₹500</button>
                                    </div>
                                </div>

                                <div class="col-md-4 m-auto">
                                    <div class="bid-info">
                                        <div class="card text-info">
                                            <p class="text-secondary">{{currentBidMember.member.skills}}</p>
                                        </div>
                                        <span>Base Price</span>
                                        <h1 class="base-price shadow">₹{{currentBidMember.member.basePrice}}</h1>
                                        <span>Current Bid</span>
                                        <h1 class="current-bid shadow">₹{{currentBidMember.member.currentBid}}</h1>
                                        <span>Time Remaining</span>
                                        <h1 class="time-remaining shadow" id="countdown">00:00:30</h1>
                                    </div>
                                </div>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>



            <script>
                // Function to handle bid button clicks
                document.querySelectorAll('.bid-btn').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const bidAmount = event.target.getAttribute('data-bid');

                        // Send bid request to the server
                        const response = await fetch('/bid', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ bidAmount })
                        });

                        const result = await response.json();

                        if (result.success) {
                            // Update the current bid on the page
                            document.querySelector('.current-bid').innerText = `₹${result.newBidPrice}`;

                            // Update the countdown timer
                            document.querySelector('#countdown').innerText = result.newTime;
                        } else {
                            alert(result.message);
                        }
                    });
                });

                // Function to start countdown timer
                function startCountdown(initialTime) {
                    let time = initialTime;

                    const countdownInterval = setInterval(() => {
                        time -= 1;
                        document.getElementById('countdown').innerText = `00:00:${time < 10 ? '0' : ''}${time}`;

                        if (time <= 0) {
                            clearInterval(countdownInterval);
                            // Handle timer end, maybe send a request to finalize auction
                            finalizeAuction();
                        }
                    }, 1000);
                }

                // Example to initialize the countdown (use the real initial time from server)
                startCountdown(30);

                async function finalizeAuction() {
                    const response = await fetch('/finalize-auction', { method: 'POST' });
                    const result = await response.json();

                    if (result.success) {
                        alert('Auction ended, member assigned to the last bidder.');
                        location.reload();  // Reload the page to show the next auction
                    } else {
                        alert('Error finalizing auction.');
                    }
                }
            </script>

        </div>


        <!--view added items-->

        <div class="row view-our-members-container">
            <h4 class="mb-3">View Our Members</h4>
            <div class="col-md-3">
                <div class="card">
                    <a href="/user/our-members"></a>
                    <div class="view-our-members">
                        <p class="text-center px-2">Sub Junior</p>
                        <ul class="members-list ps-3">
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card">
                    <div class="view-our-members">
                        <p class="text-center px-2">Junior</p>
                        <ul class="members-list ps-3">
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card">
                    <div class="view-our-members">
                        <p class="text-center px-2">Senior</p>
                        <ul class="members-list ps-3">
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card">
                    <div class="view-our-members">
                        <p class="text-center px-2">Super Senior</p>
                        <ul class="members-list ps-3">
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                            <li class="item">
                                <img class="rounded-circle" src="https://wallpapercave.com/wp/wp2525416.jpg" alt=""
                                    height="40">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>